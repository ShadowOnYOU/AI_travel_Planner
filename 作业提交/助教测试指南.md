# 👨‍🏫 助教测试指南

## 🚀 快速开始

有两种部署方式可选择：**Docker镜像部署**（推荐）和**源码编译部署**

### 方式一：Docker镜像部署（推荐）⭐

#### 一键启动命令
```bash
docker run -d --name ai-travel-planner -p 3000:3000 --platform linux/amd64 -e NEXT_PUBLIC_AMAP_KEY=f47ba60794341f862ce2c49df4e2e14b -e NEXT_PUBLIC_BAILIAN_API_KEY=sk-9404820cdc734865a5301c966c4ad016 crpi-ttmopfgqdmld0jn5.cn-hangzhou.personal.cr.aliyuncs.com/ai_by_sgh/ai-travel-planner:latest
```

**命令说明**：
- `-d`: 后台运行容器
- `--name`: 给容器命名，便于管理
- `-p 3000:3000`: 端口映射
- `--platform linux/amd64`: 确保兼容性
- `-e`: 设置环境变量（API密钥）

**⚠️ 重要**：环境变量是必需的，缺少会导致AI功能和地图功能无法正常工作！

### 容器管理命令
```bash
# 查看运行状态
docker ps

# 停止容器
docker stop ai-travel-planner

# 重新启动
docker start ai-travel-planner

# 删除容器（如需重新创建）
docker rm ai-travel-planner
```

### 方式二：从GitHub源码部署

#### 前置要求
- Node.js 20+ 
- npm 或 yarn 
- Git

#### 步骤1: 克隆仓库
```bash
git clone https://github.com/ShadowOnYOU/AI_travel_Planner.git
cd AI_travel_Planner
```

#### 步骤2: 安装依赖
```bash
# 使用npm（推荐）
npm install --legacy-peer-deps

# 或使用yarn
yarn install
```

#### 步骤3: 环境配置
```bash
# 复制环境变量模板
cp .env.example .env.local

# 编辑环境变量文件
nano .env.local  # 或使用其他编辑器
```

在 `.env.local` 中设置以下变量：
```bash
# 高德地图API
NEXT_PUBLIC_AMAP_KEY=f47ba60794341f862ce2c49df4e2e14b

# 阿里云百炼AI
NEXT_PUBLIC_BAILIAN_API_KEY=sk-9404820cdc734865a5301c966c4ad016
NEXT_PUBLIC_BAILIAN_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
NEXT_PUBLIC_BAILIAN_MODEL_ID=qwen-plus

# Supabase数据库（可选，用于用户系统）
NEXT_PUBLIC_SUPABASE_URL=https://untvtsdpychqwikqdkgg.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVudHZ0c2RweWNocXdpa3Fka2dnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NjM4NjQsImV4cCI6MjA3NjEzOTg2NH0.3lTm4PFwCxxKWgjE5YFP90I0oQgNKn-scOKCOqitIWs
```

#### 步骤4: 启动应用
```bash
# 开发模式
npm run dev

# 或生产模式
npm run build
npm start
```

#### 步骤5: 访问应用
- 开发模式：http://localhost:3000
- 生产模式：http://localhost:3000

#### 自动化脚本
项目提供了便捷的启动脚本：
```bash
# 使用内置脚本
chmod +x run.sh
./run.sh

# 或使用Docker脚本
chmod +x docker-start.sh  
./docker-start.sh
```

### 部署方式对比

| 特性 | Docker镜像 | 源码编译 |
|------|------------|----------|
| 部署速度 | ⭐⭐⭐⭐⭐ 极快 | ⭐⭐⭐ 中等 |
| 环境依赖 | ⭐⭐⭐⭐⭐ 仅需Docker | ⭐⭐ 需Node.js环境 |
| 资源占用 | ⭐⭐⭐ 中等 | ⭐⭐⭐⭐ 较低 |
| 调试便利 | ⭐⭐ 有限 | ⭐⭐⭐⭐⭐ 极佳 |
| 适用场景 | 快速验证、生产部署 | 开发调试、功能扩展 |

**推荐**：
- **快速验证功能**：使用Docker镜像部署
- **深度测试调试**：使用源码编译部署

### 测试账户
```
📧 用户名: 335933870@qq.com
🔐 密码: 123321
```

## 🧪 功能测试路径

### ⚠️ 必须首先进行：API密钥配置验证

**重要**：在进行任何功能测试之前，必须先配置和验证API密钥，否则核心功能无法正常工作。

#### Step 0: API密钥配置（必须第一步完成）
1. **访问配置页面**：http://localhost:3000/config
2. **配置高德地图API**：
   - 点击"高德地图"标签页
   - 输入API Key：`1e967f9e5d863f52e8e76a8b7c381669`
   - 点击"🧪 测试连接"验证
   - 确保显示"✅ 连接成功"

3. **配置阿里云百炼AI**：
   - 点击"阿里云百炼"标签页
   - 输入以下信息：
     ```
     API Key: sk-7b2ff1814ecb499d89d56e86af030b19
     Base URL: https://dashscope.aliyuncs.com/compatible-mode/v1
     Model ID: qwen-plus
     ```
   - 点击"🧪 测试连接"验证
   - 确保显示"✅ 连接成功"

4. **保存配置**：
   - 点击"💾 保存配置"按钮
   - 确认配置已保存

**预期结果**：所有API连接状态显示为绿色"✅ 已连接"

**⚠️ 如果跳过此步骤**：
- AI行程规划功能将无法工作
- 地图显示可能异常
- 系统会显示API配置错误

### 1. 基础功能验证（必测）

#### Step 1: 用户系统测试
- 访问：http://localhost:3000/auth/signin
- 使用测试账户登录
- **预期结果**：成功登录并跳转到主页

#### Step 2: AI 行程规划测试  
- 访问：http://localhost:3000/plan
- 填写行程信息：
  ```
  目的地：北京
  出发日期：选择任意日期
  天数：3天
  预算：3000元
  出行人数：2人
  旅行风格：休闲观光
  ```
- 点击"生成行程"
- **预期结果**：AI 生成详细的3天北京行程

#### Step 3: 保存功能测试（重点）
- 在生成的行程详情页面查看**醒目的黄色提示横幅**
- 点击"💾 保存到我的行程"按钮
- 观察保存状态变化和成功通知
- **预期结果**：
  - 按钮显示保存中状态
  - 出现绿色成功通知
  - 询问是否跳转到行程列表

#### Step 4: 行程管理测试
- 访问：http://localhost:3000/itinerary
- 查看已保存的行程列表
- **预期结果**：看到刚才保存的北京行程

#### Step 5: 地图可视化测试
- 在行程详情页面点击"🗺️ 查看地图"
- **预期结果**：显示带有景点标记和路线的地图

#### Step 6: 行程编辑功能测试
- 在行程详情页面点击"✏️ 编辑行程"按钮
- **预期结果**：跳转到行程编辑页面
- 修改行程标题、目的地、预算等信息
- 编辑行程概述和添加/删除标签
- 更改行程状态（草稿/已确认/已完成/已取消）
- 点击"保存修改"
- **预期结果**：
  - 成功保存修改
  - 返回行程详情页面
  - 显示更新后的信息

### 2. 高级功能验证（可选）

#### 语音输入测试
- 在规划页面点击麦克风图标
- 说出旅行需求
- **预期结果**：语音转换为文字填入表单

#### 配置页面测试
- 访问：http://localhost:3000/config
- 测试各 API 连接状态
- **预期结果**：显示连接状态和测试结果

## ⚠️ 重要注意事项

### Supabase 数据库密钥过期

**现象**：如果遇到以下情况，说明 Supabase 密钥已过期
- 用户登录/注册失败
- 行程保存功能异常
- 控制台出现数据库连接错误
- 碰到这种情况请和我联系一下～（QQ:335933870），我可以更新一下key之后重新上传一下

### 测试重点

#### ✅ 必须正常的功能
1. **AI 行程生成**：核心 AI 功能
2. **地图可视化**：景点和路线展示
3. **行程编辑功能**：完整的CRUD操作支持
4. **用户界面**：响应式设计和交互
5. **保存提示**：新增的用户体验改进

#### ⚠️ 可能受影响的功能（不影响评分）
1. **用户注册**：如 Supabase 过期
2. **数据持久化**：如 Supabase 过期
3. **跨设备同步**：依赖数据库功能

## 🚨 故障处理

### Docker部署故障

#### 容器启动失败
```bash
# 检查 Docker 状态
docker --version

# 查看详细日志
docker logs [容器名]

# 重新拉取镜像（指定平台）
docker pull --platform linux/amd64 crpi-ttmopfgqdmld0jn5.cn-hangzhou.personal.cr.aliyuncs.com/ai_by_sgh/ai-travel-planner:latest
```

### 端口占用
```bash
# 使用其他端口
docker run --rm -p 8080:3000 --platform linux/amd64 [镜像地址]
# 然后访问 http://localhost:8080
```

### 平台兼容性问题

**Apple Silicon Mac (ARM64) 架构问题**：

**问题现象**：
```
no matching manifest for linux/arm64/v8 in the manifest list entries
```

**解决方案**：
```bash
# 1. 拉取镜像时指定平台
docker pull --platform linux/amd64 crpi-ttmopfgqdmld0jn5.cn-hangzhou.personal.cr.aliyuncs.com/ai_by_sgh/ai-travel-planner:latest

# 2. 运行时确保使用 --platform 参数
docker run -d --name ai-travel-planner -p 3000:3000 --platform linux/amd64 -e NEXT_PUBLIC_AMAP_KEY=f47ba60794341f862ce2c49df4e2e14b -e NEXT_PUBLIC_BAILIAN_API_KEY=sk-9404820cdc734865a5301c966c4ad016 crpi-ttmopfgqdmld0jn5.cn-hangzhou.personal.cr.aliyuncs.com/ai_by_sgh/ai-travel-planner:latest

# 3. 如果仍有问题，清理并重试
docker system prune -a --volumes
```

**Intel Mac 用户**：
```bash
# 直接运行，无需指定平台
docker run -d --name ai-travel-planner -p 3000:3000 -e NEXT_PUBLIC_AMAP_KEY=f47ba60794341f862ce2c49df4e2e14b -e NEXT_PUBLIC_BAILIAN_API_KEY=sk-9404820cdc734865a5301c966c4ad016 crpi-ttmopfgqdmld0jn5.cn-hangzhou.personal.cr.aliyuncs.com/ai_by_sgh/ai-travel-planner:latest
```

### 源码部署故障

#### Node.js版本问题
```bash
# 检查Node.js版本（需要20+）
node --version

# 如果版本过低，安装新版本
# 推荐使用nvm管理Node.js版本
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20
```

#### 依赖安装失败
```bash
# 清理缓存后重新安装
npm cache clean --force
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps

# 如果仍有问题，尝试yarn
npm install -g yarn
yarn install
```

#### 构建失败
```bash
# 检查环境变量是否正确设置
cat .env.local

# 如果缺少.env.local文件
cp .env.example .env.local
nano .env.local  # 按上述说明填写

# 重新构建
npm run build
```

#### 端口占用问题
```bash
# 查看端口占用
lsof -i :3000

# 使用其他端口启动
PORT=8080 npm run dev
# 然后访问 http://localhost:8080
```

#### API连接问题
- 确保网络连接正常
- 检查API密钥是否正确配置
- 访问 http://localhost:3000/config 进行配置验证
- 查看浏览器开发者工具的网络面板排查具体错误

## 📞 联系方式

- **开发者**：ShadowOnYOU
- **GitHub**：https://github.com/ShadowOnYOU/AI_travel_Planner  
- **项目文档**：完整的 README 和作业提交文档
- **技术支持**：GitHub Issues

---

## 📋 完整测试检查清单

### 预备检查
- [ ] Docker已安装并运行（Docker部署）或Node.js 20+已安装（源码部署）
- [ ] 网络连接正常
- [ ] 端口3000未被占用

### 部署验证
- [ ] 应用成功启动（Docker容器运行或npm进程启动）
- [ ] 访问 http://localhost:3000 显示登录页面
- [ ] 页面样式正常加载，无明显UI错误

### API配置验证（关键步骤）
- [ ] 访问 http://localhost:3000/config
- [ ] 高德地图API配置成功（绿色✅状态）
- [ ] 阿里云百炼AI配置成功（绿色✅状态）
- [ ] 点击"保存配置"成功

### 核心功能验证
- [ ] 使用测试账户 335933870@qq.com / 123321 成功登录
- [ ] 访问 http://localhost:3000/plan 规划页面
- [ ] 填写旅行信息并生成AI行程
- [ ] 查看生成的详细行程内容
- [ ] 看到黄色保存提示横幅
- [ ] 点击"保存到我的行程"成功
- [ ] 访问 http://localhost:3000/itinerary 查看保存的行程
- [ ] 点击行程卡片进入行程详情页面
- [ ] 点击"✏️ 编辑行程"测试编辑功能
- [ ] 修改行程信息并成功保存

### 可选功能验证
- [ ] 地图可视化功能正常
- [ ] 语音输入功能可用（需浏览器支持）
- [ ] 响应式设计在不同屏幕尺寸下正常

### 质量评估
- [ ] 生成的行程内容合理、详细
- [ ] 用户界面友好，交互流畅
- [ ] 无明显的功能性错误
- [ ] 保存提示机制有效改善用户体验

---

**🎯 Docker快速验证命令**（推荐复制粘贴）:
```bash
docker run -d --name ai-travel-planner -p 3000:3000 --platform linux/amd64 -e NEXT_PUBLIC_AMAP_KEY=f47ba60794341f862ce2c49df4e2e14b -e NEXT_PUBLIC_BAILIAN_API_KEY=sk-9404820cdc734865a5301c966c4ad016 crpi-ttmopfgqdmld0jn5.cn-hangzhou.personal.cr.aliyuncs.com/ai_by_sgh/ai-travel-planner:latest && echo "访问 http://localhost:3000/auth/signin 使用账户 335933870@qq.com / 123321"
```

**🛠️ 源码快速验证命令**:
```bash
git clone https://github.com/ShadowOnYOU/AI_travel_Planner.git && cd AI_travel_Planner && npm install --legacy-peer-deps && cp .env.example .env.local && echo "请编辑 .env.local 配置API密钥后执行: npm run dev"
```